<!DOCTYPE html>
<html lang="de">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Indikator</title>

    <link href="assets/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">   
    <link href="assets/css/indikatoren-filter.css" media="screen" rel="stylesheet" type="text/css">
    
    <script src="assets/js/modules/jquery/dist/jquery.min.js" type="text/javascript"></script>    
    <script src="assets/js/modules/filter.js/src/template.js" type="text/javascript"></script>
    <script src="assets/js/url-min.js" type="text/javascript"></script>
    <script src="assets/js/modules/proj4/dist/proj4.js"></script>        
    <script src="assets/js/modules/highcharts/highstock.js" type="text/javascript"></script>
    <script src="assets/js/modules/highcharts/highcharts-more.js" type="text/javascript"></script>    
    <script src="assets/js/modules/highcharts/modules/data.js" type="text/javascript"></script>
    <script src="assets/js/modules/highcharts/modules/map.js" type="text/javascript"></script>
	  <script src="assets/js/modules/highcharts/modules/exporting.js" type="text/javascript"></script> 
    <script src="charts/templates/options001.js" type="text/javascript"></script>    
    <script src="metadata/all/templatesById.js" type="text/javascript"></script>
    <script src="assets/js/indikatoren-highcharts.js" type="text/javascript"></script>
    <script src="geojson/wohnviertel_EPSG_2056.js"></script>
    <script src="geojson/rhein_EPSG_2056.js"></script>

    <style type="text/css">
      a {
        text-decoration: none;
        color: inherit;
      }
      
      .lesehilfe {
        width: 468px;
      }
    </style>


  </head>

  <body style="margin: 0;">
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-KGK459"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KGK459');</script>
    <!-- End Google Tag Manager -->

    <div id="bs-logo">
    	<a class='bs-logo-link' style='display: block; font-family: Arial, sans-serif; color: black; text-decoration: none; padding: 10px 0px 10px 0px;' href="http://www.statistik.bs.ch" title="Startseite">
    		<img class='bs-logo-img' style='float: left; padding: 0px 20px;' src="assets/img/logo-print.png" alt="Logo Kanton Basel-Stadt"/>
    		<div class='bs-logo-title' style='padding-top: 17px; font-size: 11px'>Präsidialdepartement des Kantons Basel-Stadt</div>
    		<div class='bs-logo-text' style='padding-top: 3px; font-weight: 700; font-size: 15px'>Statistisches Amt</div>
    		</p>
    	</a>
  	</div>

    <div style='clear: both;'/>

    <div id='bs-nav' style='background-color: rgb(29, 78, 44); height: 45px; padding: 15px 0px 10px 50px; margin-bottom: 30px;'>
      <a style='color: white; font-size: 13px; font-weight: 700; text-shadow: rgb(23, 62, 35) 0px -1px 0px; text-decoration: none;' href='http://www.statistik.bs.ch/zahlen/indikatoren/portal.html'>
        Indikatoren
      </a>
    </div>

    <!-- template for chart plus details -->
    <script id="indikator-template-modal-portal" type="text/html">
      <div class="item">
        <div id="container-<%= id %>" indikator-id-data="<%= id %>" indikator-kuerzel-data="<%= kuerzel %>" class="highcharts-wrapper"></div>
        <h1><%= 'Indikator ' + kuerzel %></h1>
        <!-- hide lesehilfe if empty -->
        <div id='lesehilfe' class=<%= (lesehilfe==="" ? "'hidden'": "''" ) %>>
          <h1>Lesehilfe</h1>
          <div class='lesehilfe'><%= lesehilfe %>
          </div>
        </div>                      
        <!-- hide erlaeuterungen info if empty -->
        <div id='erlaeuterungen' class=<%= (erlaeuterungen==="" ? "'hidden'": "''" ) %>>
          <h1>Erläuterungen  und methodische Hinweise</h1>
          <div class='lesehilfe'><%= erlaeuterungen %>
          </div>
        </div>
        <!-- hide Links if empty -->    
        <%= renderLinksHTML((typeof(kennzahlenset)!=='undefined' ? kennzahlenset: null), (typeof(renderLink) !== 'undefined' ? renderLink : null), (typeof(externalLinks)!=='undefined' ? externalLinks : null ), 'portal', stufe1, 'link') %>
      </div>
    </script> 
    
    

    <script type="text/javascript">
            
            
      
      /*  
      global $
      global templatesById
      global lazyRenderChartById
      global templateBuilder
      */
      
      //get kuerzel and id from url, encode to prevent xss 
      //todo: in order to prevent xss: do not evaluate chart templates but just load json. Functions need to be taken out of the templates. 
      var id = window.decodeURIComponent($.url('?id'));
      
      //check if id is member in the list of existing charts
      if (templatesById[id]){
        $.getJSON('metadata/single/'+ id + '.json').done(function(chartMetadata, textStatus){     
            //retrieve template and merge with json to create html
            var html = $('#indikator-template-modal-portal').html();
            var templateFunction = templateBuilder(html);
            //append generated html
            var container = $('body');
            container.append(templateFunction(chartMetadata));
            
            lazyRenderChartById(id, chartMetadata, 'portal');
        });
      }
      else {
        //display error message
        $('body').append('<div class="container"><div class="jumbotron"><h1>Ooops...</h1><p>Kein Chart mit diesem Kürzel bzw. dieser id gefunden.</p></div></div>');
      }
      
    </script>

  </body>
</html>
